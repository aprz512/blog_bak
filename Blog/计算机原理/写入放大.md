---
title: 写入放大
date: 2020-9-1
categories: 计算机原理
---

闪存基本构成是由：页page（4K）→块block（通常64个page组成一个block，有的是128个）→面plane（多个blcok组成）→die（plane就是一个die）→闪存片（多个die组成）→SSD（多颗闪存片组成）

![img](https://pic4.zhimg.com/80/38d2501ae92f54a2d02edae6341a6b2b_720w.jpg?source=1940ef5c)

**一个块block是由128个页page组成，一个页page是大小是4KB**

![img](https://pic2.zhimg.com/80/391984c01d25ffcee3ab622b84831b5e_720w.jpg?source=1940ef5c)

**↑↑↑↑一个面Plane由1024个块block组成**

△▼△▼△▼△▼△▼分割线▼△▼▽▼△▼△▼△

其实写入放大很好理解，而造成写入的元凶是GC垃圾回收。

说之前先说下操作系统当删除一个数据时，他不会立马删除，而是把这个要删除的数据上标记一个“删”的标签，实际上没有真正删除，就是因为如此硬盘上数据纯在可恢复的原因。

而机械硬盘与固态硬盘工作原理不同，当机械硬盘要写入新数据时可以直接覆盖那些已经被标记“删”标签的数据，而固态硬盘不行，只能先擦除旧的数据才能写入新数据。

NAND闪存工作原理是以4K页（page）为一个单元写入的，但擦除只能以块block（64个page）为单位。

如果一个块block上有32个page有效数据和32个被标记“删”标签的无效数据，那要在这个块block上重新写入数据，那**必须要擦除整个块block**，那还有一半有效数据怎么办了？那只有把那32page的有效数据就要**搬到另一个有空位置**的块block中，这个这就是GC垃圾回收技术，那把那有效的数据搬到另一个块block中，原本就已经写入过一次了再加上这次搬迁不就又多了一次写入吗，这就是所谓的写入放大。