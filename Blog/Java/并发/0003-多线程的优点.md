# 多线程的优点

尽管使用多线程会遇到很多困难，但是由于它带来的好处实在是太大了，所以掌握多线程是必须的。

下面我们举几个例子来说一下多线程的好处：



## 更高的资源利用率

想象一下，一个应用程序需要从本地文件系统中读取和处理文件的情景。

比方说，从磁盘读取一个文件需要5秒，处理一个文件需要2秒。处理两个文件则需要：

```
1 | 5s读取文件A
2 | 2s处理文件A
3 | 5s读取文件B
4 | 2s处理文件B
-----------------
一共耗时 5 + 5 + 2 + 2 = 14s
```

我们思考一下可以优化的地方：

> 从磁盘中读取文件的时候，这段时间内，CPU 是没有做任何事情的，就白白浪费了

在这段时间里，CPU非常的空闲。它可以做一些别的事情。那么，怎么利用这段时间，用 CPU 去做别的事情呢。

通过改变操作的顺序，就能够更好的使用CPU资源。看下面的顺序：

```
1 | 5秒读取文件A
2 | 5秒读取文件B + 2秒处理文件A
3 | 2秒处理文件B
----------------------------
一共耗时 5 + 5 + 2 秒
(仔细想了一下，这个例子应该是单CPU的情况下的顺序)
```

CPU等待第一个文件被读取完，然后开始读取第二个文件。当第二文件在被读取的时候，CPU会去处理第一个文件。**记住，在等待磁盘读取文件的时候，CPU大部分时间是空闲的**。

总的说来，**CPU能够在等待IO的时候做一些其他的事情**。这个不一定就是磁盘IO。它也可以是网络的IO，或者用户输入。通常情况下，网络和磁盘的IO比CPU和内存的IO慢的多。



## 更简单的程序设计

在单线程应用程序中，如果你想编写程序处理上面所提到的读取和处理的顺序，你必须记录每个文件读取和处理的状态。

但是如果你启动两个线程，每个线程处理一个文件的读取和操作。线程会在等待磁盘读取文件的过程中被阻塞。在等待的时候，其他的线程能够使用CPU去处理已经读取完的文件。

其结果就是，磁盘总是在繁忙地读取不同的文件到内存中。这会带来磁盘和CPU利用率的提升。而且每个线程只需要记录一个文件，因此这种方式也很容易编程实现。



## 更快的响应速度

假设我们有一个服务器，我们写了一个服务应用用来处理用户的请求，它的大致流程如下：

```java
while(server is active) {
    listen for request
	process request
}
```

假如处理有的用户请求需要占用很长的时间，那么在这段时间之内，服务器就无法响应别的用户的请求了。

所以我们可以这样设计：

```java
while(server is active){
    listen for request
    hand request to worker thread
}
```

我们为每个请求单独分配一个线程去处理，然后服务端线程立刻再去监听用户请求。因此，更多的客户端能够发送请求给服务端。这个服务也变得响应更快。



我们的应用也是如此。如果我们点击了一个按钮，要去开始一个非常耗时的任务，如果我们直接在 UI 线程执行，那么在任务执行的过程中，这个应用程序看起来好像没有反应一样。

但是如果我们开启一个工作线程去处理，当工作者线程在繁忙地处理任务的时候，UI线程可以自由地响应其他用户的请求。当工作者线程完成任务的时候，它发送信号给窗口线程。UI线程便可以更新应用程序窗口，并显示任务的结果。

